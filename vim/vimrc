" IMPORTANT FOR CANCELLING/ABORTING GIT COMMIT
" ALWAYS USE `:cq`.

" IMPORTANT FOR WRAPPING THE TEXT IN MARKDWON
" ALWAYS USE `gq`.

" FIND AND REPLACE IN VIM
" :grep original_string
" :cfdo %s/original_string/new_string/g | write

if has('vim_starting')
  set nocompatible               " Be iMproved
endif

" VIM-PLUG
call plug#begin('~/.vim/plugged')
  " PRODUCTIVITY {{
    Plug 'lukas-reineke/indent-blankline.nvim'
    Plug 'preservim/tagbar', { 'on': 'TagbarToggle' }
    Plug 'phaazon/hop.nvim'
    Plug 'szw/vim-maximizer'
    Plug 'junegunn/vim-easy-align'
    Plug 'maxbrunsfeld/vim-yankstack'
    Plug 'rhysd/clever-f.vim'
    Plug 'mileszs/ack.vim'
    Plug 'wellle/targets.vim'
    Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
    Plug 'junegunn/fzf.vim'
    Plug 'mbbill/undotree'
    Plug 'rhysd/committia.vim'
    Plug 'AndrewRadev/tagalong.vim'
    Plug 'AaronLasseigne/yank-code'
    Plug 'mrjones2014/dash.nvim', { 'do': 'make install' }
    Plug 'janko-m/vim-test'
    Plug 'skywind3000/asyncrun.vim'
    Plug 'dbeniamine/cheat.sh-vim'
    Plug 'nvim-treesitter/nvim-treesitter', {'do': ':TSUpdate'}  " We recommend updating the parsers on update
    Plug 'voldikss/vim-floaterm'
    Plug 'akinsho/toggleterm.nvim'
    Plug 'SirVer/ultisnips'
    Plug 'github/copilot.vim'
    Plug 'nvim-lua/popup.nvim'
    Plug 'nvim-lua/plenary.nvim'
    Plug 'nvim-telescope/telescope.nvim'
    Plug 'nvim-telescope/telescope-fzf-native.nvim', { 'do': 'make' }
    Plug 'sindrets/diffview.nvim'
    Plug 'kyazdani42/nvim-tree.lua'
    Plug 'kevinhwang91/nvim-bqf' " Important pugin for quickfix
    Plug 'andymass/vim-matchup'
    Plug 'windwp/nvim-spectre'
    Plug 'neovim/nvim-lspconfig'
    Plug 'hrsh7th/cmp-nvim-lsp'
    Plug 'hrsh7th/cmp-buffer'
    Plug 'hrsh7th/nvim-cmp'
    Plug 'quangnguyen30192/cmp-nvim-ultisnips'
    Plug 'tzachar/cmp-tabnine', { 'do': './install.sh' }
    Plug 'onsails/lspkind-nvim'
    Plug 'dcampos/nvim-snippy'
    Plug 'dcampos/cmp-snippy'
    Plug 'hrsh7th/cmp-cmdline'
    Plug 'hrsh7th/cmp-path'
    Plug 'numToStr/Comment.nvim'
    Plug 'lewis6991/gitsigns.nvim'
    Plug 'RRethy/nvim-treesitter-endwise'
    Plug 'pechorin/any-jump.vim'
    Plug 'liuchengxu/vim-which-key'
    Plug 'ThePrimeagen/harpoon'
    Plug 'wincent/command-t', {
      \   'do': 'cd ruby/command-t/ext/command-t && ruby extconf.rb && make'
      \ }
  " }}

  " PERFORMANCE {{
    Plug 'antoinemadec/FixCursorHold.nvim'
  " }}

  " Method lookup/snippets {{
    Plug 'honza/vim-snippets'
  " }}

  " RUBY {{
    Plug 'vim-ruby/vim-ruby'
    Plug 'sunaku/vim-ruby-minitest'
    Plug 'thoughtbot/vim-rspec'
  " }}

  " TPOPE's must have plugins {{
    Plug 'tpope/vim-repeat'
    Plug 'tpope/vim-surround'
    Plug 'tpope/vim-unimpaired'
    Plug 'tpope/vim-git'
    Plug 'tpope/vim-fugitive'
    Plug 'tpope/vim-rhubarb'
    Plug 'tpope/vim-rake'
    Plug 'tpope/vim-rails'
    Plug 'tpope/vim-dispatch'
    Plug 'tpope/vim-dadbod'
    Plug 'tpope/vim-abolish'
  " }}

  " More git plugins dependent on 'tpope/vim-fugitive' {{
    Plug 'junegunn/gv.vim'
  " }}

  " JAVASCRIPT {{
    Plug 'pangloss/vim-javascript'
    Plug 'prettier/vim-prettier', { 'do': 'yarn install --frozen-lockfile --production' }
  " }}

  " TEMPLATES {{
    Plug 'slim-template/vim-slim'
  " }}

  " COLORSCHEME {{
    Plug 'w0ng/vim-hybrid'
    Plug 'nanotech/jellybeans.vim'
    Plug 'tomasr/molokai'
    Plug 'ful1e5/onedark.nvim'
    Plug 'gruvbox-community/gruvbox'
    Plug 'cocopon/iceberg.vim'
    Plug 'doums/darcula'
    Plug 'rakr/vim-one'
    Plug 'NLKNguyen/papercolor-theme'
    Plug 'mhartington/oceanic-next'
    Plug 'folke/tokyonight.nvim', { 'branch': 'main' }
    Plug 'ackyshake/Spacegray.vim'
    Plug 'dracula/vim', { 'as': 'dracula' }
    Plug 'rebelot/kanagawa.nvim'
    Plug 'EdenEast/nightfox.nvim'
    Plug 'olimorris/onedarkpro.nvim'
    Plug 'Mofiqul/vscode.nvim'
    Plug 'catppuccin/nvim', {'as': 'catppuccin'}
  " }}

  " ENHANCEMENT {{
    if v:version >= 703
      " Plug 'mhinz/vim-signify'
    endif
    Plug 'wincent/terminus'
    Plug 'thinca/vim-quickrun' " Ruby code runnner
    Plug 'nvim-lualine/lualine.nvim'
    Plug 'kristijanhusak/vim-dadbod-ui' " depend on tpope/vim-dadbod
    Plug 'machakann/vim-highlightedyank'
    Plug 'folke/trouble.nvim' " May be we don't need it
    Plug 'itchyny/calendar.vim'
    Plug 'AndrewRadev/whatif.vim'
  " }}

  " EXTRA {{
    Plug 'lifepillar/vim-cheat40'
    Plug 'chrisbra/csv.vim'
    Plug 'airblade/vim-localorie'
    Plug 'rhysd/git-messenger.vim'
    Plug 'ruifm/gitlinker.nvim'
  " }}

  " Load this as the very last one
  " Plug 'ryanoasis/vim-devicons'
  Plug 'kyazdani42/nvim-web-devicons'
call plug#end()

" keep this at the top {{
  syntax enable
" }}

packadd! dracula_pro " ~/.local/share/nvim/site/pack/themes/start/dracula_pro/

set completeopt=menu,menuone,noselect

" Exit from Terminal {{
  tnoremap <Esc> <C-\><C-n>
" }}

" Time limit of each task in seconds for vim-plug
let g:plug_timeout = 100

" airblade/vim-localorie {{
  nnoremap <silent> <leader>lt :call localorie#translate()<CR>
  nnoremap <silent> <leader>le :echo localorie#expand_key()<CR>
" }}

" Disable python2 provider
let g:loaded_python_provider = 0

if filereadable('/usr/local/bin/python3')
  " Avoid search, speeding up start-up.
  let g:python3_host_prog='/usr/local/bin/python3'
endif

let g:make = 'gmake'
if exists('make')
  let g:make = 'make'
endif

if has('nvim')
  " runtime! macros/matchit.vim
  let g:loaded_matchit = 1 " We use vim-matchup plugin
else
  " VIM HAS ITS VERY OWN'S 'ADD-PACKAGE' FEATURE:
  " This plugin makes the '%' command jump to matching HTML tags, if/else/endif in Vim scripts, etc.
  packadd! matchit
endif

let no_buffers_menu = 1

if has('gui_running')
  if has("gui_macvim")
    set macligatures
    set guifont=JetBrainsMono\ Nerd\ Font\ Mono:h18
  endif
else
  set termguicolors
endif

" COLORSHEME SETTINGS
" let g:dracula_colorterm = 0
" colorscheme dracula
" colorscheme kanagawa

" Example config in VimScript
" configuration needs to be set BEFORE loading the color scheme with `colorscheme` command
" let g:onedark_function_style = "italic"
" let g:onedark_sidebars = ["qf", "vista_kind", "terminal", "packer"]
" let g:dark_sidebar = 'false'

" Change the "hint" color to the "orange0" color, and make the "error" color bright red
" let g:onedark_colors = {
"   \ 'hint': 'orange0',
"   \ 'error': '#ff0000'
" \ }

" Load the colorscheme

" vscode color setting
let g:vscode_style = "dark"
" Enable transparent background
let g:vscode_transparency = 1
" Enable italic comment
let g:vscode_italic_comment = 1
" Disable nvim-tree background color
let g:vscode_disable_nvimtree_bg = v:true
colorscheme vscode

" Basic setup
set clipboard=unnamed
set number                        " show line numbers
set ruler                         " show the cursor position all the time
set title                         " show file in titlebar
set encoding=utf-8                " set default encoding to UTF-8
set history=50                    " keep 50 lines of command line history

if !has('nvim')
  set ttymouse=xterm2
endif

set mouse=n                       " automatically enable mouse usage in normal mode.
set mousehide                     " hide the mouse cursor while typing
set textwidth=120
set showcmd                       " display incomplete commands
set ttyfast                       " faster redrawing.
set lazyredraw                    " don't redraw while executing macros (good performance config)
set showmatch                     " show matching brackets
set noshowmode
set matchtime=2                   " show matching bracket for 0.2 seconds
set autoindent                    " always set auto indenting on
set smartindent
set display=lastline              " show as much as possible of the last line.
set scrolloff=10                  " minimum lines to keep above and below cursor
set hidden                        " switch between buffers without having to save first.
set foldenable                    " auto fold code
set pastetoggle=<F2>
set confirm                       " get a dialog when :q, :w, or :wq fails
set cursorline                    " find the current line quickly.
set wrapscan                      " searches wrap around end-of-file
set bomb
set binary
set synmaxcol=256                 " This helps to avoid very slow redrawing for long lines
set updatetime=300                " delay time. Useful for showing git sign
set undodir=~/.vim/undodir
set undofile
set number

" Whitespace
set nowrap                        " don't wrap text
set tabstop=2                     " tab spacing
set expandtab                     " use spaces instead of tabs
set softtabstop=2                 " unify
set shiftwidth=2                  " indent/outdent by 2 columns
set smarttab                      " use tabs at the start of a line, spaces elsewhere
set backspace=indent,eol,start    " backspace through everything in insert mode
set list                          " show invisible characters
set nojoinspaces                  " Use only 1 space after "." when joining lines, not 2

" Don't pass messages to |ins-completion-menu|.
set shortmess+=c

set signcolumn=yes

" Disable swap files; systems don't crash that often these days
set updatecount=0

set breakindent
set showbreak=↪\
set linebreak

" Searching
set hlsearch                      " highlight matches
set incsearch                     " incremental searching
set ignorecase                    " searches are case insensitive...
set smartcase                     " unless they contain at least one capital letter
set gdefault                      " have :s///g flag by default on

" Time out on key codes but not mappings. basically this makes terminal vim work sanely.
set ttimeout
set ttimeoutlen=100
set timeoutlen=500

" Tab completion
set pumblend=17
set wildoptions=pum

" Disable output and vcs files
set wildignore+=*.o,*.out,*.obj,.git,*.rbc,*.rbo,*.class,.svn,*.gem,tags,.fugitiveblame

" Disable archive files
set wildignore+=*.zip,*.tar.gz,*.tar.bz2,*.rar,*.tar.xz

" Ignore bundler and sass cache
set wildignore+=*/vendor/gems/*,*/vendor/cache/*,*/.bundle/*,*/.sass-cache/*

" Ignore rails temporary asset caches
set wildignore+=*/tmp/*,*/solr/*,*/coverage/*,*/features/*,*/public/uploads/*

" Disable temp and backup files
set wildignore+=*.swp,*~,._*,tags

" Backup and swap files
set nobackup                      " turn backup off, since most stuff is in SVN, Git etc anyway...
set nowb                          " no writebackup
set noswapfile

" Better display for messages.
set cmdheight=2

set fileformats=unix,dos,mac

" Open new split panes to right and bottom, which feels more natural
set splitright
set splitbelow

" Mac's option key for yankring
if has('gui_running' && !has('nvim'))
  set macmeta
endif

" Autocomplete with dictionary words when spell check is on
set complete+=kspell

" Always use vertical diffs
if &diff
  set diffopt-=internal
  set diffopt+=vertical
endif

" clever-f.vim plugin {{
  let g:clever_f_ignore_case = 1
" }}

" For AndrewRadev/tagalong.vim {{
  let g:tagalong_mappings = [{'c': '<leader>c'}, {'C': '<leader>C'}, 'v', 'i', 'a']
" }}

" make test commands execute using dispatch.vim {{
  let test#strategy = "neovim"
" }}

set tags+=.git/tags

" INDICATOR CHARS
if has('multi_byte') && &encoding ==# 'utf-8'
  let &listchars = 'tab:▸ ,extends:❯,precedes:❮,nbsp:±'
else
  let &listchars = 'tab:> ,extends:>,precedes:<,nbsp:.'
endif

if has("statusline") && !&cp
  set laststatus=2 " always show the status bar
endif

set winbar=%=%m\ %f " new feature

let g:mapleader = ","

" TREAT <li> AND <p> TAGS LIKE THE BLOCK TAGS THEY ARE
let g:html_indent_tags = 'li\|p'

" Every time you open a git object using fugitive it creates a new buffer.
" This means that your buffer listing can quickly become swamped with
" fugitive buffers. This prevents this from becomming an issue:
autocmd BufReadPost fugitive://* set bufhidden=delete

let g:github_enterprise_urls = ['https://github.com']

"Highlight column for 119 characters.
if exists('+colorcolumn')
  set colorcolumn=+1
else
  au BufWinEnter * let w:m2=matchadd('ErrorMsg', '\%>80.\+', -1)
endif

" Quicker window movement
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-h> <C-w>h
nnoremap <C-l> <C-w>l

" Show next matched string at the center of screen
nnoremap n nzz
nnoremap N Nzz

" FZF settings {{
  " Project files
  nnoremap <Leader>pf :Files<CR>

  let g:fzf_layout = { 'down': '~30%' }
  let $FZF_DEFAULT_OPTS='--reverse'
  noremap <leader>gc :GCheckout<CR>
" }}

" Searching {{
  nnoremap <leader>ghw :h <C-R>=expand("<cword>")<CR><CR>
" }}

" mileszs/ack.vim {{
  if executable('ag')
    let g:ackprg = 'ag --vimgrep'
  endif
" }}

" Puts the calller (Thanks to @tenderlove)
nnoremap <leader>wtf oputs "#" * 90<c-m>puts caller<c-m>puts "#" * 90<esc>

" Disable 'Entering Ex mode'
map Q <Nop>
map gs <Nop>

" MOVEMENT
nnoremap j gj
nnoremap k gk
vnoremap j gj
vnoremap k gk
nnoremap gj j
nnoremap gk k
vnoremap gj j
vnoremap gk k

" highlight last inserted text
nnoremap gV `[v`]

" Ruby hash syntax conversion
nnoremap <F12> :%s/:\([^ ]*\)\(\s*\)=>/\1:/g<return>

" EASY COPY AND PASTE
" yank to system clipboard
map <leader>y "*y

" paste lines from unnamed register and fix indentation
nmap <leader>p pV`]=
nmap <leader>P PV`]=

map <c-a> ggVG

" format the entire file
nmap <leader>fef ggVG=

" upper/lower word
nmap <leader>u mQviwU`Q
nmap <leader>l mQviwu`Q

" upper/lower first char of word
nmap <leader>U mQgewvU`Q
nmap <leader>L mQgewvu`Q

" find Git merge conflict markers
nmap <silent> <leader>fc <ESC>/\v^[<=>]{7}( .*\|$)<CR>

" Toggle hlsearch with <leader>hs
nmap <leader>hls :set hlsearch! hlsearch?<CR>

" EasyAlign {{
  " Start interactive EasyAlign in visual mode (e.g. vipga)
  xmap ga <Plug>(EasyAlign)
  " Start interactive EasyAlign for a motion/text object (e.g. gaip)
  nmap ga <Plug>(EasyAlign)
" }}

" Adjust viewports to the same size
map <Leader>= <C-w>=

" vim-maximizer (Zoom) {{
  noremap <Leader>zw :MaximizerToggle<CR>
  vnoremap <Leader>zw :MaximizerToggle<CR>gv
  inoremap <Leader>zw <C-o>:MaximizerToggle<CR>
" }}

" Tagbar {{
  nnoremap <Leader>rt :TagbarToggle<CR>
" }}

" disable cursor keys in normal mode
map <Left>  :echoe "Use h"<cr>
map <Right> :echoe "Use l"<cr>
map <Up>    :echoe "Use k"<cr>
map <Down>  :echoe "Use j"<cr>

"Make shift-insert work like in Xterm
map <S-Insert> <MiddleMouse>
map! <S-Insert> <MiddleMouse>

" In command-line mode, C-a jumps to beginning (to match C-e)
cnoremap <C-a> <Home>

" Run the last command
nnoremap <leader><leader>c :<up>

" Easy edit/open commands
command! EditVim  :edit   ~/.vimrc

function! s:setWrapping()
  set wrap
  set wrapmargin=2
  set textwidth=80
endfunction

if has("autocmd")
  " In Makefiles, use real tabs, not tabs expanded to spaces
  au FileType {make,gitconfig} set noexpandtab

  " Make sure all markdown files have the correct filetype set and setup wrapping
  au BufRead,BufNewFile *.{md,markdown,mdown,mkd,mkdn,txt} setf markdown | call s:setWrapping()

  " Treat JSON files like JavaScript
  au BufNewFile,BufRead *.json setf javascript

  " Treat all *html.erb and *pdf.erb files like eruby
  au BufNewFile,BufRead *html.erb set filetype=eruby.html
  au BufNewFile,BufRead *pdf.erb set filetype=eruby.html

  " Treat all *scss.erb files like scss
  au BufNewFile,BufRead *scss.erb set filetype=scss.css

  " Better commit message
  au Filetype gitcommit setlocal spell textwidth=72

  " For all text files set 'textwidth' to 80 characters.
  au Filetype text setlocal textwidth=80

  " Enable spellchecking for Markdown
  au FileType markdown setlocal spell

  au FileType javascript set formatprg=prettier\ --stdin

  " Every time you save your file(s), they'll attempt to format using the registered LSP,
  " and if none exist, it'll be a no-op.
  " au BufWritePre * lua vim.lsp.buf.formatting_sync()
endif

" nvim-tree {{
  :nmap <Leader>n :NvimTreeToggle<CR>
  :nmap <Leader>F :NvimTreeFindFile<CR>
" }}

" any-jump.vim {{
  let g:any_jump_search_prefered_engine = 'ag'
  let g:any_jump_preview_lines_count = 10
  let g:any_jump_ignored_files = ['*.tmp', '*.temp', '*.log']
" }}

" nvim-telescope/telescope.nvim {{
  nnoremap <c-b> <cmd>lua require('telescope.builtin').buffers(require('telescope.themes').get_ivy({}))<cr>
  nnoremap <c-p> <cmd>lua require('telescope.builtin').find_files(require('telescope.themes').get_ivy({}))<cr>
  nnoremap <leader>fg <cmd>lua require('telescope.builtin').live_grep(require('telescope.themes').get_ivy({}))<cr>
  nnoremap <leader>fh <cmd>lua require('telescope.builtin').help_tags(require('telescope.themes').get_ivy({}))<cr>
" }}


" mrjones2014/dash.nvim {{
  nnoremap <leader>D <cmd>:DashWord<cr>
" }}

" voldikss/vim-floaterm {{
  " let g:floaterm_keymap_new = '<Leader>ft'
  " let g:floaterm_keymap_toggle = '<Leader>tt'
  " let g:floaterm_width = 0.9
  " let g:floaterm_height = 0.9

  " These GUI colors for background and foreground are set based on the
  " OceanicNext colorscheme. We can change these colors based on the
  " colorscheme using ':hi Normal' comand in Vim
  " hi FloatermBorder guibg=#282c34 guifg=#abb2bf
" }}

" akinsho/toggleterm.nvim {{
   " set
  let g:toggleterm_terminal_mapping = '<Leader>tt'
  " or manually...
  autocmd TermEnter term://*toggleterm#*
        \ tnoremap <silent><Leader>tt <Cmd>exe v:count1 . "ToggleTerm"<CR>

  " By applying the mappings this way you can pass a count to your
  " mapping to open a specific window.
  " For example: 2<C-t> will open terminal 2
  nnoremap <silent><Leader>tt <Cmd>exe v:count1 . "ToggleTerm"<CR>
  inoremap <silent><Leader>tt <Esc><Cmd>exe v:count1 . "ToggleTerm"<CR>
" }}

" antoinemadec/FixCursorHold.nvim {{
  let g:cursorhold_updatetime = 100
" }}

" 'windwp/nvim-spectre' {{
  nnoremap <leader>S :lua require('spectre').open()<CR>

  "search current word
  nnoremap <leader>sw :lua require('spectre').open_visual({select_word=true})<CR>
  vnoremap <leader>s :lua require('spectre').open_visual()<CR>
  "  search in current file
  nnoremap <leader>sp viw:lua require('spectre').open_file_search()<cr>
" }}

" github/copilot.vim {{
  imap <silent><script><expr> <C-J> copilot#Accept("\<CR>")
  let g:copilot_no_tab_map = v:true
  let g:copilot_filetypes = {
        \ 'TelescopePrompt': v:false,
        \ }
" }}

" /liuchengxu/vim-which-key {{
  let g:which_key_map = {}
  call which_key#register(',', "g:which_key_map")
  nnoremap <silent> <leader>      :<c-u>WhichKey ','<CR>
  nnoremap <silent> <localleader> :<c-u>WhichKey  ','<CR>
" }}

lua << EOF
require("trouble").setup {}
EOF

lua << EOF
local cb = require'diffview.config'.diffview_callback

require'diffview'.setup {
  diff_binaries = false,    -- Show diffs for binaries
  use_icons = true,         -- Requires nvim-web-devicons,
  file_panel = {
    win_config = {
      position = "left",
      width = 35,
      height = 16,
    },
  },
  key_bindings = {
    disable_defaults = false,                   -- Disable the default key bindings
    -- The `view` bindings are active in the diff buffers, only when the current
    -- tabpage is a Diffview.
    view = {
      ["<tab>"]     = cb("select_next_entry"),  -- Open the diff for the next file
      ["<s-tab>"]   = cb("select_prev_entry"),  -- Open the diff for the previous file
      ["<leader>e"] = cb("focus_files"),        -- Bring focus to the files panel
      ["<leader>b"] = cb("toggle_files"),       -- Toggle the files panel.
    },
    file_panel = {
      ["j"]             = cb("next_entry"),         -- Bring the cursor to the next file entry
      ["<down>"]        = cb("next_entry"),
      ["k"]             = cb("prev_entry"),         -- Bring the cursor to the previous file entry.
      ["<up>"]          = cb("prev_entry"),
      ["<cr>"]          = cb("select_entry"),       -- Open the diff for the selected entry.
      ["o"]             = cb("select_entry"),
      ["<2-LeftMouse>"] = cb("select_entry"),
      ["-"]             = cb("toggle_stage_entry"), -- Stage / unstage the selected entry.
      ["S"]             = cb("stage_all"),          -- Stage all entries.
      ["U"]             = cb("unstage_all"),        -- Unstage all entries.
      ["X"]             = cb("restore_entry"),      -- Restore entry to the state on the left side.
      ["R"]             = cb("refresh_files"),      -- Update stats and entries in the file list.
      ["<tab>"]         = cb("select_next_entry"),
      ["<s-tab>"]       = cb("select_prev_entry"),
      ["<leader>e"]     = cb("focus_files"),
      ["<leader>b"]     = cb("toggle_files"),
    }
  }
}
EOF

lua << EOF
require'nvim-web-devicons'.setup {
  -- your personnal icons can go here (to override)
  -- DevIcon will be appended to `name`
  override = {
    zsh = {
      icon = "",
      color = "#428850",
      name = "Zsh"
      }
    };
  -- globally enable default icons (default to false)
  -- will get overriden by `get_icons` option
  default = true;
}
EOF

lua << EOF
require'nvim-treesitter.configs'.setup {
  ensure_installed = "all",
  highlight = {
    enable = true,
    disable = { 'ruby' },
    additional_vim_regex_highlighting = true,
  },
  matchup = {
    enable = true, -- mandatory, false will disable the whole extension
  },
  indent = {
    enable = true
  },
  -- This endwise is a part of 'RRethy/nvim-treesitter-endwise'
  endwise = {
    enable = true,
  },
}
EOF

lua << EOF
require('telescope').setup {
  defaults = {
    layout_config = {
      prompt_position = "top"
    },
    sorting_strategy = "ascending",
    vimgrep_arguments = {
      'rg',
      '--color=never',
      '--no-heading',
      '--with-filename',
      '--line-number',
      '--column',
      '--smart-case',
      '--ignore',
      '--hidden'
    },
    file_ignore_patterns = {
      '.git',
      'node_modules'
    }
  },
  pickers = {
    buffers = {
      sort_mru = true,
      ignore_current_buffer = true
    }
  },
  extensions = {
    fzf = {
      fuzzy = true,                    -- false will only do exact matching
      override_generic_sorter = true,  -- override the generic sorter
      override_file_sorter = true,     -- override the file sorter
      case_mode = 'smart_case',        -- or "ignore_case" or "respect_case"
                                       -- the default case_mode is "smart_case"
    },
    dash = {
      file_type_keywords = {
        ruby = { 'ruby', 'rails' }
      }
    }
  }
}

-- To get fzf loaded and working with telescope, you need to call
-- load_extension, somewhere after setup function:
require('telescope').load_extension('fzf')
EOF

lua << EOF
require"gitlinker".setup()
EOF

lua << EOF
-- vim.opt.list = true
-- vim.opt.listchars:append("space:⋅")
-- vim.opt.listchars:append("eol:↴")

require("indent_blankline").setup {
  show_end_of_line = true,
  -- space_char_blankline = " ",
}
EOF

lua << EOF
require'nvim-tree'.setup {
  hijack_cursor = true,
  view = {
    width = 35,
    auto_resize = true
  },
  diagnostics = {
    enable = true
  },
  filters = {
    dotfiles = true,
  }
}
EOF

lua << EOF
require('gitsigns').setup()
EOF

lua << EOF
require("harpoon").setup()
vim.api.nvim_set_keymap('n', '<leader>ha', ':lua require("harpoon.mark").add_file()<CR>', { noremap = true, silent = true })
vim.api.nvim_set_keymap('n', '<leader>ht', ':lua require("harpoon.ui").toggle_quick_menu()<CR>', { noremap = true, silent = true })
EOF

lua << EOF
require'hop'.setup()
vim.api.nvim_set_keymap('n', '<leader><leader>w', ':HopWordAC<CR>', { noremap = true, silent = true })
vim.api.nvim_set_keymap('n', '<leader><leader>b', ':HopWordBC<CR>', { noremap = true, silent = true })
EOF

lua << EOF
require'lualine'.setup {
  options = {
    -- theme = 'onedark',
    globalstatus = true,
    component_separators = { left = '', right = ''},
    section_separators = { left = '', right = ''},
    disabled_filetypes = {}
    -- ... your lualine config
  }
}
EOF

lua << EOF
require('Comment').setup()
EOF

lua << EOF
require("toggleterm").setup{}
EOF

lua << EOF
-- Setup nvim-cmp.
local lspkind = require('lspkind')
local cmp = require'cmp'

cmp.setup({
  snippet = {
    expand = function(args)
      -- require'snippy'.expand_snippet(args.body) -- For `snippy` users.
      vim.fn["UltiSnips#Anon"](args.body) -- For `ultisnips` users.
    end,
  },
  window = {
    completion = cmp.config.window.bordered(),
    documentation = cmp.config.window.bordered(),
  },
  mapping = cmp.mapping.preset.insert({
    ['<C-d>'] = cmp.mapping.scroll_docs(-4),
    ['<C-f>'] = cmp.mapping.scroll_docs(4),
    ['<C-Space>'] = cmp.mapping.complete(),
    ['<C-e>'] = cmp.mapping.close(),
    ['<C-y>'] = cmp.mapping.confirm({ select = true }),
  }),
  sources = cmp.config.sources({
    { name = 'nvim_lsp' },
    { name = 'ultisnips' }, -- For ultisnips users.
    -- { name = 'snippy' },
    { name = 'buffer', keyword_length = 4, max_item_count = 5 },
    { name = 'cmp_tabnine', keyword_length = 2, max_item_count = 5 },
    { name = 'path' }
  }),
  formatting = {
    format = lspkind.cmp_format({ with_text = false, maxwidth = 50 })
  }
})

-- Use buffer source for `/` (if you enabled `native_menu`, this won't work anymore).
cmp.setup.cmdline('/', {
  mapping = cmp.mapping.preset.cmdline(),
  sources = {
    { name = 'buffer' }
  }
})

-- Use cmdline & path source for ':' (if you enabled `native_menu`, this won't work anymore).
cmp.setup.cmdline(':', {
  mapping = cmp.mapping.preset.cmdline(),
  sources = cmp.config.sources({
    { name = 'path' }
  }, {
    { name = 'cmdline' }
  })
})
EOF

lua << EOF
local tabnine = require('cmp_tabnine.config')
tabnine:setup({
        max_lines = 1000;
        max_num_results = 20;
        sort = true;
	      run_on_every_keystroke = true;
	      snippet_placeholder = '..';
})
EOF

lua << EOF
-- Use an on_attach function to only map the following keys
-- after the language server attaches to the current buffer
local on_attach = function(client, bufnr)
  local function buf_set_keymap(...) vim.api.nvim_buf_set_keymap(bufnr, ...) end
  local function buf_set_option(...) vim.api.nvim_buf_set_option(bufnr, ...) end

  -- Enable completion triggered by <c-x><c-o>
  buf_set_option('omnifunc', 'v:lua.vim.lsp.omnifunc')

  -- Mappings.
  local opts = { noremap=true, silent=true }

  -- See `:help vim.lsp.*` for documentation on any of the below functions
  buf_set_keymap('n', 'gD', '<cmd>lua vim.lsp.buf.declaration()<CR>', opts)
  buf_set_keymap('n', 'gd', '<cmd>lua vim.lsp.buf.definition()<CR>', opts)
  buf_set_keymap('n', 'K', '<cmd>lua vim.lsp.buf.hover()<CR>', opts)
  buf_set_keymap('n', 'gi', '<cmd>lua vim.lsp.buf.implementation()<CR>', opts)
  buf_set_keymap('n', '<C-s>', '<cmd>lua vim.lsp.buf.signature_help()<CR>', opts)
  buf_set_keymap('n', '<space>wa', '<cmd>lua vim.lsp.buf.add_workspace_folder()<CR>', opts)
  buf_set_keymap('n', '<space>wr', '<cmd>lua vim.lsp.buf.remove_workspace_folder()<CR>', opts)
  buf_set_keymap('n', '<space>wl', '<cmd>lua print(vim.inspect(vim.lsp.buf.list_workspace_folders()))<CR>', opts)
  buf_set_keymap('n', '<space>D', '<cmd>lua vim.lsp.buf.type_definition()<CR>', opts)
  buf_set_keymap('n', '<space>rn', '<cmd>lua vim.lsp.buf.rename()<CR>', opts)
  buf_set_keymap('n', '<space>ca', '<cmd>lua vim.lsp.buf.code_action()<CR>', opts)
  buf_set_keymap('n', 'gr', '<cmd>lua vim.lsp.buf.references()<CR>', opts)
  buf_set_keymap('n', '<space>e', '<cmd>lua vim.diagnostic.open_float()<CR>', opts)
  buf_set_keymap('n', '[d', '<cmd>lua vim.lsp.diagnostic.goto_prev()<CR>', opts)
  buf_set_keymap('n', ']d', '<cmd>lua vim.lsp.diagnostic.goto_next()<CR>', opts)
  buf_set_keymap('n', '<space>q', '<cmd>lua vim.lsp.diagnostic.set_loclist()<CR>', opts)
  buf_set_keymap('n', '<space>f', '<cmd>lua vim.lsp.buf.formatting()<CR>', opts)
end

-- Setup lspconfig.
local nvim_lsp = require('lspconfig')
local servers = { 'solargraph', 'tsserver', 'cssls', 'html', 'vimls' }
-- local capabilities = vim.lsp.protocol.make_client_capabilities()
-- capabilities = require('cmp_nvim_lsp').update_capabilities(capabilities)
vim.lsp.handlers["textDocument/publishDiagnostics"] = vim.lsp.with(
  vim.lsp.diagnostic.on_publish_diagnostics, {
      virtual_text = false
  }
)

for _, lsp in ipairs(servers) do
  nvim_lsp[lsp].setup {
    on_attach = on_attach,
    capabilities = require('cmp_nvim_lsp').update_capabilities(vim.lsp.protocol.make_client_capabilities()),
    flags = {
      debounce_text_changes = 150,
    }
  }
end
EOF

source ~/.local_vimrc

" FIX CONSTANT SPELLING MISTAKES
" Copy content from https://raw.githubusercontent.com/moshahmed/vim/master/thesaurus/thesaurii.txt
" and in this file /Users/yanis/thesaurus/words.txt
" set thesaurus+=/Users/yanis/thesaurus/words.txt
iab Acheive    Achieve
iab acheive    achieve
iab Alos       Also
iab alos       also
iab Aslo       Also
iab aslo       also
iab Becuase    Because
iab becuase    because
iab Bianries   Binaries
iab Charcter   Character
iab charcter   character
iab Charcters  Characters
iab charcters  characters
iab Seperate   Separate
iab seperate   separate
iab biding     binding
iab binging    binding
iab biging     binding
iab bindng     binding
iab bindging   binding
iab bindgin    binding
iab gindin     binding
iab bindin     binding
iab bindign    binding
iab attachemnts attachments
iab attachemnt attachment
iab udpate     update
iab beybug     byebug
